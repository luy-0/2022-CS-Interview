# 【对线面试官】数据库Q&A

对线面试官系列是摘录技术面中常见问题并提供标准回答的系列文章，不涉及任何知识点的详细讲解。

~~说白了就是八股文。~~

## 数据库索引

### 数据库索引为什么用B+树实现？

众所周知，二分查找是一种查询效率很高的方法。这种方法对应的数据结构是二叉搜索树，也就是“左子树小于结点的值，右子树大于结点的值的二叉树”。查询效率主要取决于BST的高度。==二分查找->BST==

但是在BST失衡的情况下，二叉树就会退化成线性的时间复杂度。因此又有了平衡二叉树，它能够保持自平衡，从而最大限度地降低树的高度，提高效率。==BST失衡->AVL==

那么为什么不用AVL树呢？这是因为数据库并不是放在内存中，每次**从磁盘中读取**的开销很大。树的查询时间跟树的高度强相关，B树（Balance-Tree）和B+树都是**多路搜索树可以降低树的高度，提高查找效率**。==B类树-多路->降低读取次数==

可是数据库总共就是这么大，你读取次数少了，单次读取的数据量不就大了吗？这肯定要花费更多的时间。事实上由于**每次从磁盘读取数据时总是以“页”为单位的**，因此从外存读入1个数据和读入4KB的数据（一般页大小为4KB）花费的时间是差不多的。既然开销差不多，那每次当然是尽量多读。**因此B-Tree的每个结点大小都正好是1页的大小**。==B树页面大小4KB==

那么B+树比B树的优势又在哪里呢？在B树中，数据是可以存贮在非叶子结点和叶子结点中的，也就是说，索引结点页承担了一部分的数据结点的功能，这就导致了在一个非叶子结点中，部分空间开销被用于存储数据。而B+树就是把这部分空间用于存储索引那么每个节点存储的关键字数更多，**树的层级更少，查询数据更快**。并且所有指关键字指针都存在叶子节点，所以每次**查找的次数都相同所以查询速度更稳定**。==B+索引更快，更稳定==

### 为什么数据库索引不用红黑树实现？

红黑树与B+树都是平衡树，但是使用 B+ 树**访问磁盘数据有更高的性能**。

（一）B+ 树有更低的高度，这时由于B+树是多路的，而红黑树的度只有2 ==B+树多叉，RB树二叉==

（二）磁盘访问原理  ==寻道时间费时,次数越少越好==

由于寻道时间比较费时，所以磁盘访问次数强限制查询效率。B+ 树高度更低，寻道次数更少，磁盘旋转时间更少。

（三）磁盘预读特性

为了减少磁盘 I/O 操作，磁盘往往不是严格按需读取，而是每次都会预读。预读过程中，磁盘进行顺序读取，顺序读取不需要进行磁盘寻道，并且只需要很短的磁盘旋转时间，速度会非常快。并且可以利用预读特性，相邻的节点也能够被预先载入。==预读特性使B+树能预加载== 

