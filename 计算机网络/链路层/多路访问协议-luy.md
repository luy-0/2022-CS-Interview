# 多路访问协议

在链路层，网络链路可分为两类：点对点链路（Point-to-Point）和广播链路（Broadcast）。

点对点链路是一对一通信。因为不会发生碰撞，因此也比较简单，使用 PPP 协议进行控制。

广播链路是指，在同一套广播信道中，存在多个节点。因为广播链路中的所有节点都能传输（接受）信息帧，如果有多个节点同时广播帧，这些信息帧会在接收方**碰撞**。当发生碰撞时，信号互相纠缠，导致所有的信息都丢失了。如果节点会频繁地发生碰撞，那么广播信道中的大量资源被浪费。

为了统筹广播信道的使用，制定 **多路访问协议** 。这些协议可被主要分为三类：

1. 信道划分协议
2. 随机接入协议
3. 轮流协议

一个理想的多路访问协议应该满足

1. 单节点活跃时，它拥有R的吞吐量
2. 多节点活跃时，每个节点拥有R/N的吞吐量

## 信道划分协议

### 时分多路复用（TDM） 与 频分多路复用（FDM）

TDM将时间划分为时隙，并分配给链路上的不同节点。

TDM能够绝对地消除碰撞，也是公平的。其主要缺陷有二：

1. 节点平均速率上限被限制在 `R/N bps` 
2. 节点必须要等待至自己轮次才能发言。

FDM是类似的协议，不过划分的是频段。优缺点同上

### 码分多址（CDMA）

前两者分配的分别是时隙与频率，而码分多址划分的是**编码方式**。不同的节点使用不同的编码来存储信息，如果设计恰当，信息可以同时发送，碰撞时也不会收到干扰而损失信息。

一个简单的例子可以[参考此处](https://github.com/CyC2018/CS-Notes/blob/master/notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%20-%20%E9%93%BE%E8%B7%AF%E5%B1%82.md#5-%E7%A0%81%E5%88%86%E5%A4%8D%E7%94%A8)

## 随机接入协议

在这类协议中，节点总是以信道的全部速率发送（占用整个信道）。当发生碰撞时，节点将会在随机时延后重发信息。由于此处的随机时延一般是由节点自行判断，因此再次碰撞的可能性是小的。

### ALOHA协议

1. 当信息帧抵达时，节点立即将其传输进信道中。
2. 如果发生碰撞，那么在本次传输结束后，节点将以概率`p`立即重传，或者以概率`1-p`保持空闲。
3. 本协议的最大效率为 `1/(2e)`，低。

### 时隙ALOHA

1. 所有节点具有同步的时隙。
2. 当信息帧抵达时，节点**在下一个时隙开始时**将其传输进信道中。
3. 如果发生碰撞，那么在本次传输结束后，节点将以概率`p`**在下一个时隙开始时**重传，或者以概率`1-p`保持空闲。
4. 本协议的最大效率为 `1/(e)≈0.37`，较低。

### ⭐具有碰撞检测的载波侦听多路访问（CSMA/CD）

1. 载波侦听：在开始发送数据前，必须检测到在一小段时间内，信道中没有其他信号。
2. 碰撞检测：如果在传输过程中发现了碰撞，那么**立即**结束传输。（而不是等本次传输结束）
3. 随机时延：在结束传输后，随机一段时延后再进行传输。

Q： 为什么有了载波侦听，还会发生碰撞？

A：因为传输时延的存在。在A发出信息到信息抵达B处的这段时间内，B认为信道为空并发送信息，会导致侦听下的碰撞。但即便考虑到这种情况，存在载波侦听的协议碰撞几率也远低于没有载波侦听的协议。

Q：随机时延的“随机”具体是指什么？

A：CDMS/CD的时延算法称为 **二进制指数后退算法**。

- 在第一次碰撞时，选定 `K = random{0,1}`；
- 在第二次碰撞时，选定 `K = random{0,1,2,3}`；
- 在第n次碰撞时，选定 `K = random{0,1,2,3,4,5,...,2^n-1}`
- 碰撞次数大于10时，K仅从1~1023中随机取数。

以以太网为例，实际的节点等待时间为`k * 512比特时间`，即512比特进入以太网所需时间的K倍。

CDMA/CD 的最大效率可为1（理想情况）

## 轮流协议

### 轮询协议Polling

1. 选定其中一个节点为主节点。
2. 主节点循环地访问每个节点，并告知本次可以传输的帧的最多数量。
3. 若节点1不需要传输或传输完毕，主节点继续访问节点2.

轮询协议消除了信息的碰撞和空时隙，但是引入了轮询时延。更加严重的缺点是：整个信道依赖于主节点的正常工作，系统抗风险能力低。

### 令牌传递协议 Token-passing

1. 存在某个称为令牌的特助帧，它会依次在节点之间交换。
2. 当且仅当拥有令牌的节点可以使用信道。
3. 当前节点没有信息传输，或传输最大书目的信息后，立即把令牌传给下一个节点。

令牌传递协议消除了信息的碰撞和空时隙，比较高效，设计上也是分散的。但同样存在单节点的故障导致整个信道崩溃的可能。



## 参考资料

[计算机网络：自顶向下方法(原书第6版) ](https://www.douban.com/link2/?url=https%3A%2F%2Fbook.douban.com%2Fsubject%2F26176870%2F&query=自顶向下&cat_id=1001&type=search&pos=6)

[计算机网络 - 链路层](https://github.com/CyC2018/CS-Notes/blob/master/notes/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%20-%20%E9%93%BE%E8%B7%AF%E5%B1%82.md)